Grammar:		DataElement 5.0
Namespace:		shr.allergy
Description:	"The SHR Allergy domain contains definitions for statements dealing with substance-related risks, including allergies and intolerances."
Uses:			shr.core, shr.base, cimi.core, cimi.context, cimi.topic, cimi.statement, cimi.entity, cimi.element

CodeSystem:     SCT = http://snomed.info/sct
CodeSystem:		CAT = http://hl7.org/fhir/allergy-intolerance-category

Element:		AdverseSensitivityTopic
Based on:		AssertionTopic
Concept:		TBD	
Description:	"A finding related to the presence or absence of an individual's risk or sensitivity to a substance or class of substances. A finding can be taken as tantamount to a representation of an allergic condition, allowing it to be tracked over time."
0..1			AllergenIrritant
0..*			SubstanceCategory from http://hl7.org/fhir/ValueSet/allergy-intolerance-category
0..1			Type from http://hl7.org/fhir/ValueSet/allergy-intolerance-type


Element:		AdverseSensitivityPresenceContext
Based on:		PresenceContext
Description:	"Context for adverse sensitivities that are known or suspected to exist."
0..1			ClinicalStatus from http://hl7.org/fhir/ValueSet/allergy-clinical-status
1..1			VerificationStatus from http://hl7.org/fhir/ValueSet/allergy-verification-status
0..1			Criticality from http://hl7.org/fhir/ValueSet/allergy-intolerance-criticality
0..1			MostRecentOccurrenceTime
0..*			AdverseReaction

		Element:		SubstanceCategory
		Concept:		TBD
		Description:	"Categorization of the risk substance as a food, drug, or environmental agent. For difficult-to-classify substances, one can leave this field empty or choose the most typical category."
		Value:			code

//		Element:		VerificationStatus
//		Concept:		TBD
//		Description:	"Whether an assessment has been confirmed by testing or observation."
//		Value:			code

		Element:		MostRecentOccurrenceTime
		Concept:		TBD
		Description:	"The time of the last or latest of a series of events."
		Value:			dateTime

		Element:		AdverseReaction
		Concept:		MTH#C0559546
		Description:	"An instance of a negative response to the allergy or intolerance."
		0..1			AllergenIrritant
		0..1			Manifestation
		0..1			Details
		0..1			OccurrenceTime
		0..1			Severity from http://hl7.org/fhir/ValueSet/reaction-event-severity
		0..1			RouteIntoBody
		
				Element:	AllergenIrritant	
				Concept:	TBD
				Description:"A substance that causes an allergic reaction or irritation."
				Value:		CodeableConcept from http://hl7.org/fhir/us/core/ValueSet/us-core-substance
		
				Element:	Manifestation
				Concept:	MTH#C1280464
				Description:	"A sign or symptom of an underlying condition."
				Value:		CodeableConcept from ManifestationVS

				
//--------------- Instantiations -------------------

EntryElement:	AdverseSensitivityToSubstance
Based on:		ClinicalStatement
Concept:		SCT#420134006 "Propensity to adverse reactions"	
Description:	"A finding related to the presence or absence of an individual's risk or sensitivity to a substance or class of substances. A finding can be taken as tantamount to a representation of an allergic condition, allowing it to be tracked over time."
1..1			SubjectOfInformation value is type ref(Patient)
				SourceOfInformation value is type PatientOrPractitionerOrRelatedPerson
				Signed.Attribution.EntityOrRole is type PatientOrPractitioner  // to facilitate mapping to FHIR, which only allows Patient or Practitioner as recorder (note: CLI crashes if we write this as Signed.Value.EntityOrRole)
				StatementTopic is type AdverseSensitivityTopic
				StatementContext is type AdverseSensitivityPresenceContext
1..1			StatementTopic.AllergenIrritant  // US Core requirement. See http://hl7.org/fhir/us/core/StructureDefinition-us-core-allergyintolerance.html
				StatementTopic.TopicCode is SCT#473010000 "Hypersensitivity condition (disorder)"

			
EntryElement:	NoAdverseSensitivityToSubstance
Based on:		ClinicalStatement
Concept:		MTH#C4508987 "No Allergy [to substance]"
Description:	"Used to record that a particular substance or class of substances does not pose a known elevated risk to the subject."
1..1			SubjectOfInformation value is type ref(Patient)
				SourceOfInformation value is type PatientOrPractitionerOrRelatedPerson
				Signed.Attribution.EntityOrRole is type PatientOrPractitioner
				StatementTopic is type AdverseSensitivityTopic
				StatementContext is type AbsenceContext
				StatementTopic.TopicCode from NoKnownAllergyVS

EntryElement:	NoKnownDrugAllergy
Based on:		NoAdverseSensitivityToSubstance
				AdverseSensitivityTopic.TopicCode is SCT#409137002 "No known drug allergy (situation)"
0..0			AdverseSensitivityTopic.AllergenIrritant
0..0			AdverseSensitivityTopic.SubstanceCategory //is CAT#medication

EntryElement:	NoKnownFoodAllergy
Based on:		NoAdverseSensitivityToSubstance	
				AdverseSensitivityTopic.TopicCode is SCT#429625007  "No known food allergy (situation)"
0..0			AdverseSensitivityTopic.AllergenIrritant
0..0			AdverseSensitivityTopic.SubstanceCategory //is CAT#food

EntryElement:	NoKnownFoodAllergy
Based on:		NoAdverseSensitivityToSubstance	
				AdverseSensitivityTopic.TopicCode is SCT#428607008 "No known environmental allergy (situation)"
0..0			AdverseSensitivityTopic.AllergenIrritant 
0..0			AdverseSensitivityTopic.SubstanceCategory //is CAT#environment	

EntryElement:	NoKnownAllergy
Based on:		NoAdverseSensitivityToSubstance	
Concept:		MTH#C0262580
Description:	"Express no known allergies or hypersensitivity to any food, drug, biologic, or environmental substance."
				AdverseSensitivityTopic.TopicCode is SCT#716186003 "No known allergy (situation)" 
0..0			AdverseSensitivityTopic.AllergenIrritant 
0..0			AdverseSensitivityTopic.SubstanceCategory